---
title: 'Start tracking subscribers in AWS in under 30 minutes'
excerpt: 'Building an audience is key to growing your brand.  This tutorial will have you tracking your subscribers in AWS in no time.'
coverImage: '/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/nicholas-green-nPz8akkUmDI-unsplash.jpg'
coverImageAttribution: 'Photo by <a href="https://unsplash.com/@nickxshotz?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Nicholas Green</a> on <a href="https://unsplash.com/photos/nPz8akkUmDI?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>'
date: '2023-01-30T07:00:00.000Z'
ogImage:
  url: '/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/nicholas-green-nPz8akkUmDI-unsplash.jpg'
---

Building an audience is key to growing your brand.  You want to keep your audience informed about what your doing.  The best way to do that is by building a subscriber email list.

This tutorial will have you tracking your subscribers in AWS in no time.  By the end of this article, you'll have a REST API in AWS that stores subscriber records in a [DynamoDB](https://aws.amazon.com/dynamodb/) table.

Need proof?  My [portfolio site](https://jacoborshalick.me) uses the APIs shown here to track subscribers.

If you want your own portfolio site, start with my [tutorial to setup your portfolio site in under 30 minutes](https://jacoborshalick.me/posts/nextjs-and-aws-amplify-host-a-personal-blog-in-under-30-minutes).  If you've already setup the portfolio site, this service will plug right in at the end.

So let's get your subscriber API built!

## Before you Get Started

You'll need a few things. You may already have some of them:

- [Setup an AWS Account](https://aws.amazon.com)
- [Install Node.js](https://nodejs.org)
- [Install the AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)
- [Install the SAM CLI](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/install-sam-cli.html)

This tutorial assumes you are comfortable working in the terminal and using Git. Outside of that, the tutorial will walk you through what you need to know.

## About the AWS subscribers project

The complete source for the service you'll be setting up can be found on GitHub: [aws-subscribers](https://github.com/jorshali/aws-subscribers).  The project creates a REST API hosted on AWS that will support 2 simple requests:

> `POST /subscriber` *(creates a new subscriber)*

```
{
  email: "info@focus.dev"
}
```

> `PUT /subscriber/info@focus.dev` *(updates subscriber information allowing unsubscribe)*

```
{
  email:  "info@focus.dev",`
  unsubscribeAll:  true`
}
```

The components of the REST API that will be generated by the project can be represented in AWS by the following diagram:

![aws_subscribers.004.png](/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/aws_subscribers.004.png "AWS representation of the REST API that will be generated by CloudFormation")

This project serves as a great base for any functionality you may want to add.  Here's a quick summary of what the project provides you:

- Fully automated deployment using [AWS SAM](https://aws.amazon.com/serverless/sam/) and [CloudFormation](https://aws.amazon.com/cloudformation/)
- Standardized-project structure
- Lambda function coded in TypeScript
- NoSQL database access using [DynamoDB](https://aws.amazon.com/dynamodb/)
- REST API exposed through [API Gateway](https://aws.amazon.com/api-gateway/)

Let's get started!

## Setting up the Project

Once you have installed the necessary prerequisites you can setup the project with the following terminal commands:

```
$ mkdir <project-directory>
$ cd <project-directory>
$ sam init --location git@github.com:jorshali/aws-subscribers.git
$ npm install
```

The starter project will now be available in the project directory you specified.

## Create an AWS Profile

This is the most involved part of the tutorial, but it's a one-time process.  The steps below will guide you through the creation of a user with __Administrator__ rights and a local AWS profile for that user.  This will allow you to execute the remote commands that fully automate the project deployment.

We'll start by logging into the AWS Console.  You will want to search for and select the __IAM__ service.  Once in the IAM interface, select __Users__ in the left panel.  Here you will want to select __Add User__.

You will be presented with the __Create user__ steps.  Start by providing a valid user name and select __Next__.

![screenshot_1.png](/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/screenshot_1.png "Define the username")

On the next step, select the __Add user to group__ option and click the __Create Group__ button.  Search for __AdministratorAccess__ and select the check box to the left.  Name the group __Administrator__.  Scroll to the bottom and select __Create user group__.

![screenshot_2.png](/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/screenshot_2.png "Apply AdministratorAccess to your group")

You will now be taken back to the user permission options, but you will see your newly created __Administrator__ group.  Check the box to the left of your newly created group and select __Next__.

![screenshot_3.png](/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/screenshot_3.png "Apply ")

This will take you to the __Review and Create__ screen.  Simply select __Create User__.

![screenshot_4.png](/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/screenshot_4.png "Review and create the user")

Now that we have our user, we need to generate an access key that will be used locally for running our commands.  Back on the __Users__ screen, select the user you just created.

![screenshot_5.png](/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/screenshot_5.png "Select the user you just created")

Select the __Security Credentials__ tab and scroll down to the __Access Keys__ section.  Here you will want to select the __Create access key__ button.

![screenshot_6.png](/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/screenshot_6.png "Select the security credentials tab")

When presented with Step 1, select the __Command Line Interface (CLI)__ option.  Select the "I Understand..." checkbox and select __Next__.

![screenshot_7.png](/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/screenshot_7.png "Create an access key for the user")

On Step 2, simply select __Create Access Key__.  You will now see the following with your __Access Key__ and __Secret Access Key__.  Leave this page open for the next step.

![screenshot_8.png](/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/screenshot_8.png "Specify Command Line Interface (CLI) access")

Now in your terminal, execute the following command:

```
aws configure --profile aws-subscribers-prod
```

This will ask you for your __AWS Access Key ID__ and __AWS Secret Access Key__.  Open back up  the page you left open so you can copy and paste those values.  Complete the questions as follows:

```
AWS Access Key ID [None]: AKBPRYHDIHER6NRKFAJJ
AWS Secret Access Key [None]: /FAJUdjasdfdfFJHJ/asdfujahdf+32iasdfFJEjj
Default region name [None]: us-west-2
Default output format [None]: json
```

That's it!  The hard part is over.  Now let's get this service deployed.

## Building the Project

We have to start by telling the AWS CLI that we want to use the profile we just created to deploy the project. For example, in your terminal on a Mac:

```
$ export AWS_PROFILE=aws-subscribers-prod
```

Now make sure you are in your project directory in your terminal.  Once there, we can build the project with AWS SAM:

```
$ sam build --beta-features
```

__Note__:  The beta-features flag is necessary since we are using TypeScript.

Once the build completes, it's time to deploy.

## Deploying the Project to AWS

You can now deploy to your account using the profile you selected:

```
sam deploy --guided
```

While being guided through the deployment, the defaults are generally recommended.  There are only a couple of exceptions. You can customize the Stack Name to something specific to your project.  When presented with the following prompt, answer __y__:

```
SubscriberFunction may not have authorization defined, Is this okay? [y/N]: y
```

Once the deployment completes, it will print out 3 results:

![screenshot_9.png](/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/screenshot_9.png "Results from the SAM deployment")

Hang onto the __WebEndpoint__ value as this is the URL you will be using to call your Subscriber API.

You can now login and browse your AWS Console to see the various components that were installed. For example, you will find the `subscriberFunction` within the Lambda console.

![screenshot_10.png](/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/screenshot_10.png "Lambda console with subscriberFunction")

## Configuring your personal site (optional)

If you followed my [tutorial to setup a portfolio site](https://jacoborshalick.me/posts/nextjs-and-aws-amplify-host-a-personal-blog-in-under-30-minutes) you can start using your API immediately.  In your `personal-site-starter` project, open the file `src/constants.ts`.

In this file, find the constant `SUBSCRIBER_REQUEST_URL` and replace the value with the __WebEndpoint__ value that was output by the SAM deployment.  Save the file and open a terminal in your `personal-site-starter` directory.  Start your local server by running the following command:

```
npm run dev
```

Open your site in your browser at [https://localhost:3000](https://localhost:3000).  As soon as the landing page opens, put in your email address and click __Subscribe Now__.

Now open your AWS console and search for __DynamoDB__.  Open it and in the left navigation select __Tables > Explore Items__.  Under __Tables__ select __SUBSCRIBER__.

![screenshot_11.png](/assets/blog/host-a-subscriber-rest-api-in-aws-in-under-30-minutes/screenshot_11.png "Lambda console with subscriberFunction")

Here you will see an entry for your email address!

If everything worked, simply commit these changes and push them to your Git provider.  AWS Amplify will automatically redeploy your site with the subscriber API configured.

## Running the Service Locally (optional)

You can test your service locally using Docker. You can [install Docker here](https://docs.docker.com/get-docker/). Once Docker is installed, you can start the project locally with the following commands:

```
$ sam build
$ sam local start-api --port 8080
```

Once this is running you can test the API at: `http://127.0.0.1:8080/subscriber`

If you are testing the `personal-site-starter` locally, simply change the value of `SUBSCRIBER_REQUEST_URL` in `src/constants.ts` to: `http://127.0.0.1:8080`

## Project Organization

This guide is purely focused on getting the Subscriber API up-and-running on AWS quickly. In an upcoming series, I will walk you through more project specifics.

If you want to get started customizing the project right away, here's a quick rundown of the project structure. You can browse this code from the project root in an IDE like [VS Code](https://code.visualstudio.com):

- `template.yml`: the CloudFormation template that defines the service requirements. If you want to customize the REST API URL, DynamoDB table definitions, etc, this is the place to do it.
- `subscriber`: contains the code for the `subscriberFunction`. This is where you will find the `package.json` dependency definitions, TypeScript files, and general configuration.
- `subscriber/index.ts`: the TypeScript function that handles all `/subscriber` requests. You can use this to experiment with your own functionality.

## Your service is live on AWS

That's it!  You now have an API for capturing subscribers and allowing them to unsubscribe.

If you run into any issues along the way, feel free to ask questions or post issues at:  [aws-subscribers](https://github.com/jorshali/aws-subscribers).

## What's next?

In the next post I'll be showing you how to register a domain and connect it through [Route 53](https://aws.amazon.com/route53/) in AWS so you can share your site with the world.